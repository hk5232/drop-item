<head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
</head>
<%= render "shared/header" %>

<section class="page-section portfolio" id="portfolio">
            <div class="container">
                <!-- Portfolio Section Heading-->
                <h2 class="page-section-heading text-center text-uppercase text-secondary mb-0">落とし物情報</h2>
                <!-- Icon Divider-->
                <div class="divider-custom" >
                    <div class="divider-custom-line"></div>
                    <div class="divider-custom-icon"><i class="fas fa-star"></i></div>
                    <div class="divider-custom-line"></div>
                </div>
              </div>



 <h2>拾った場所</h2>

<input id="address" type="textbox" name="location" value="新宿駅">
<input type="button" value="検索" onclick="codeAddress()">

<div id='map'></div>

<style>
#map {
  height: 600px;
  width: 600px;
  margin-top : 20px;
  margin-bottom: 20px;
}
</style>


<script>
 let map

    function initMap(){
      geocoder = new google.maps.Geocoder()

      map = new google.maps.Map(document.getElementById('map'), {
          center: {lat: 35.6809591, lng: 139.7673068 },
          zoom: 16,
      });
      
   //    google.maps.event.addListener(map, 'idle', function(){
   // 表示範囲を取得
   // let pos = map.getBounds()
   // let north = pos.getNorthEast().lat()
   // let south = pos.getSouthWest().lat()
   // let east    = pos.getNorthEast().lng()
   // let west = pos.getSouthWest().lng()
    // コントローラーに値をGETパラメータで渡す
   // jQuery.getScript("/items/search?&north=#{north}&south=#{south}&east=#{east}&west=#{west}")


    //  });
    
      <% @items.each do |m| %>
          (function(){
          var contentString = "住所：<%= m.address %>"; 

          var marker = new google.maps.Marker({
              position:{lat: <%= m.latitude %>, lng: <%= m.studios %>},
              map: map,
              title: contentString
          });

          var myInfoWindow = new google.maps.InfoWindow({
    // 吹き出しに出す文
    content: '<%= link_to m.name, item_path(m.id), method: :get, class: "btn" %>'
  });
  // 吹き出しを開く
  myInfoWindow.open(map,marker);
  // 吹き出しが閉じられたら、マーカークリックで再び開くようにしておく
  google.maps.event.addListener(myInfoWindow, "closeclick", function() {
    google.maps.event.addListenerOnce(marker, "click", function(event) {
      myInfoWindow.open(map, marker);
    });
  }); 
  });
<% end %>
         
      
      }


    </script>
  </head>
  <body>
   
    <!-- Async script executes immediately and must be after any DOM elements used in callback. -->
    <script
      src="https://maps.googleapis.com/maps/api/js?key=<%=ENV['GOOGLE_MAPS_API_KEY']%>&callback=initMap&libraries=&v=weekly"
      async
    ></script>

<footer class="footer text-center" style='width:100% !important; height:200px !important; margin-top :20px;' >
            <div class="container">
                <div class="row">
                    
                <div class="col-lg-12 mb-5 mb-lg-0">
                   <h1 class="text-uppercase mb-4">Drop Item&emsp;
                 
                      <%= link_to image_tag("app-store.svg", class:"apple-btn"), "#" %>
                       <%= link_to image_tag("google-play.png", class:"google-btn"), "#" %>
                   </h1>
                </div>
                    
                </div>
            </div>
        </footer>